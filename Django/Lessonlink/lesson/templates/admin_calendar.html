<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Department Head Calendar - LessonLink</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
        }
        
        .card-hover {
            transition: all 0.2s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .nav-item {
            transition: all 0.2s ease;
        }
        
        .nav-item:hover {
            background-color: #f8fafc;
        }
        
        .nav-item.active {
            background-color: #e0f2fe;
            color: #0284c7;
            font-weight: 500;
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e5e7eb;
        }
        
        .calendar-day {
            background-color: white;
            min-height: 120px;
            padding: 8px;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover {
            background-color: #f8fafc;
        }
        
        .calendar-day.other-month {
            background-color: #f9fafb;
            color: #9ca3af;
        }
        
        .calendar-day.today {
            background-color: #dbeafe;
            border: 2px solid #3b82f6;
        }
        
        .event-item {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            margin: 1px 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .event-item:hover {
            transform: scale(1.02);
        }
        
        .event-academic { background-color: #dbeafe; color: #1e40af; }
        .event-exam { background-color: #fecaca; color: #991b1b; }
        .event-holiday { background-color: #d1fae5; color: #065f46; }
        .event-meeting { background-color: #fef3c7; color: #92400e; }
        .event-training { background-color: #e9d5ff; color: #7c2d12; }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        
        .calendar-header-day {
            background-color: #f3f4f6;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: #374151;
        }
        
        .view-toggle {
            background-color: #f3f4f6;
            border-radius: 8px;
            padding: 4px;
            display: flex;
            gap: 4px;
        }
        
        .view-toggle button {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .view-toggle button.active {
            background-color: white;
            color: #2563eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .view-toggle button:not(.active) {
            color: #6b7280;
        }
        
        .sidebar-calendar {
            font-size: 12px;
        }
        
        .sidebar-calendar .calendar-mini-day {
            padding: 4px;
            text-align: center;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .sidebar-calendar .calendar-mini-day:hover {
            background-color: #e5e7eb;
        }
        
        .sidebar-calendar .calendar-mini-day.today {
            background-color: #3b82f6;
            color: white;
        }
        
        .sidebar-calendar .calendar-mini-day.has-event {
            background-color: #dbeafe;
            color: #1e40af;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-40">
        <div class="px-6">
            <div class="flex items-center justify-between h-16">
                <!-- Left side -->
                <div class="flex items-center space-x-4">
                    <button id="sidebar-toggle" class="lg:hidden p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="menu" class="w-5 h-5"></i>
                    </button>
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center">
                            <i data-lucide="graduation-cap" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-semibold text-gray-900">LessonLink</h1>
                            <p class="text-sm text-gray-500 hidden sm:block">Western Mindanao State University</p>
                        </div>
                    </div>
                </div>

                <!-- Right side -->
                <div class="flex items-center space-x-4">
                    <!-- Search -->
                    <div class="relative hidden md:block">
                        <input type="text" placeholder="Search events..." 
                               class="w-64 px-4 py-2 bg-gray-50 border border-gray-200 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button class="absolute right-3 top-1/2 transform -translate-y-1/2">
                            <i data-lucide="search" class="w-4 h-4 text-gray-400"></i>
                        </button>
                    </div>

                    <!-- Notifications -->
                    <button class="relative p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="bell" class="w-5 h-5"></i>
                        <span class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">3</span>
                    </button>

                    <!-- Profile -->
                    <button class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300">
                        <i data-lucide="user" class="w-4 h-4 text-gray-500"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 bg-white h-screen fixed top-16 left-0 -translate-x-full lg:translate-x-0 transition-transform duration-300 z-30 overflow-y-auto border-r border-gray-200">
            <div class="p-4">
                <!-- Create Button -->
                <button onclick="showAddEventModal()" class="w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all mb-6">
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    <span class="font-medium">Add Event</span>
                </button>

                <!-- Navigation -->
                <nav class="space-y-1 mb-6">
                    <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700">
                        <i data-lucide="home" class="w-5 h-5"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700">
                        <i data-lucide="users" class="w-5 h-5"></i>
                        <span>Teachers</span>
                    </a>
                    <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700">
                        <i data-lucide="building" class="w-5 h-5"></i>
                        <span>Departments</span>
                    </a>
                    <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700">
                        <i data-lucide="file-text" class="w-5 h-5"></i>
                        <span>Lesson Plans</span>
                    </a>
                    <a href="#" class="nav-item active flex items-center space-x-3 px-4 py-3 rounded-lg">
                        <i data-lucide="calendar" class="w-5 h-5"></i>
                        <span>Academic Calendar</span>
                    </a>
                </nav>

                <!-- Mini Calendar -->
                <div class="border-t pt-4">
                    <h3 class="text-sm font-semibold text-gray-700 mb-3">Quick Navigation</h3>
                    <div class="sidebar-calendar">
                        <div id="mini-calendar" class="bg-gray-50 rounded-lg p-3">
                            <!-- Mini calendar will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Event Legend -->
                <div class="border-t pt-4 mt-4">
                    <h3 class="text-sm font-semibold text-gray-700 mb-3">Event Types</h3>
                    <div class="space-y-2">
                        <div class="legend-item">
                            <div class="legend-color event-academic"></div>
                            <span>Academic</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color event-exam"></div>
                            <span>Exams</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color event-holiday"></div>
                            <span>Holidays</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color event-meeting"></div>
                            <span>Meetings</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color event-training"></div>
                            <span>Training</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Overlay for mobile -->
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden lg:hidden"></div>

        <!-- Main Content -->
        <main class="flex-1 lg:ml-64 p-6">
            <!-- Header Section -->
            <div class="mb-6">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Academic Calendar</h1>
                        <p class="text-gray-600 mt-1">Manage school year activities and important dates</p>
                    </div>
                    
                    <!-- Controls -->
                    <div class="flex items-center space-x-3">
                        <!-- View Toggle -->
                        <div class="view-toggle">
                            <button class="active" onclick="switchView('month')">Month</button>
                            <button onclick="switchView('year')">Year</button>
                        </div>
                        
                        <!-- Export Button -->
                        <button onclick="exportCalendar()" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span>Export</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Calendar Navigation -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                <div class="p-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <button onclick="previousMonth()" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                                <i data-lucide="chevron-left" class="w-5 h-5"></i>
                            </button>
                            <h2 id="current-month" class="text-xl font-semibold text-gray-900">September 2025</h2>
                            <button onclick="nextMonth()" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                                <i data-lucide="chevron-right" class="w-5 h-5"></i>
                            </button>
                        </div>
                        
                        <button onclick="goToToday()" class="px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors">
                            Today
                        </button>
                    </div>
                </div>

                <!-- Calendar Grid -->
                <div class="p-4">
                    <!-- Days Header -->
                    <div class="calendar-grid mb-1">
                        <div class="calendar-header-day">Sunday</div>
                        <div class="calendar-header-day">Monday</div>
                        <div class="calendar-header-day">Tuesday</div>
                        <div class="calendar-header-day">Wednesday</div>
                        <div class="calendar-header-day">Thursday</div>
                        <div class="calendar-header-day">Friday</div>
                        <div class="calendar-header-day">Saturday</div>
                    </div>
                    
                    <!-- Calendar Days -->
                    <div id="calendar-grid" class="calendar-grid">
                        <!-- Calendar days will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Upcoming Events -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                <div class="p-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Upcoming Events</h3>
                        <button onclick="showAddEventModal()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            Add Event
                        </button>
                    </div>
                </div>
                <div class="p-4">
                    <div id="upcoming-events" class="space-y-3">
                        <!-- Upcoming events will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Event Modal -->
    <div id="event-modal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 id="modal-title" class="text-lg font-semibold text-gray-900">Add New Event</h3>
                        <button onclick="closeEventModal()" class="text-gray-400 hover:text-gray-600">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <form id="event-form" onsubmit="saveEvent(event)">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Event Title</label>
                                <input type="text" id="event-title" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <textarea id="event-description" rows="3"
                                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                                    <input type="date" id="event-start-date" required
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                                    <input type="date" id="event-end-date"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Event Type</label>
                                <select id="event-type" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="academic">Academic</option>
                                    <option value="exam">Exam</option>
                                    <option value="holiday">Holiday</option>
                                    <option value="meeting">Meeting</option>
                                    <option value="training">Training</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="time" id="event-start-time"
                                           class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <input type="time" id="event-end-time"
                                           class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3 mt-6">
                            <button type="button" onclick="closeEventModal()"
                                    class="flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                Cancel
                            </button>
                            <button type="submit"
                                    class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                Save Event
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global variables
        let currentDate = new Date(2025, 8, 1); // September 2025
        let editingEventId = null;
        let events = [
            {
                id: 1,
                title: "First Day of Classes",
                description: "Academic Year 2025-2026 begins",
                startDate: "2025-09-02",
                endDate: "2025-09-02",
                type: "academic",
                startTime: "08:00",
                endTime: "17:00"
            },
            {
                id: 2,
                title: "Faculty Meeting",
                description: "Monthly faculty meeting for all departments",
                startDate: "2025-09-15",
                endDate: "2025-09-15",
                type: "meeting",
                startTime: "14:00",
                endTime: "16:00"
            },
            {
                id: 3,
                title: "Midterm Examinations",
                description: "Midterm examination period",
                startDate: "2025-10-15",
                endDate: "2025-10-22",
                type: "exam",
                startTime: "08:00",
                endTime: "17:00"
            },
            {
                id: 4,
                title: "National Heroes Day",
                description: "Public holiday",
                startDate: "2025-08-26",
                endDate: "2025-08-26",
                type: "holiday"
            },
            {
                id: 5,
                title: "Teacher Training Workshop",
                description: "AI in Education workshop for faculty",
                startDate: "2025-09-20",
                endDate: "2025-09-21",
                type: "training",
                startTime: "09:00",
                endTime: "16:00"
            }
        ];

        // Sidebar toggle functionality
        document.getElementById('sidebar-toggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        });

        document.getElementById('overlay').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        });

        // Calendar functions
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update month display
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            document.getElementById('current-month').textContent = `${monthNames[month]} ${year}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            // Clear calendar grid
            const calendarGrid = document.getElementById('calendar-grid');
            calendarGrid.innerHTML = '';
            
            // Generate calendar days
            const today = new Date();
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                // Add classes for styling
                if (date.getMonth() !== month) {
                    dayElement.classList.add('other-month');
                }
                if (date.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // Day number
                const dayNumber = document.createElement('div');
                dayNumber.className = 'font-medium text-sm mb-1';
                dayNumber.textContent = date.getDate();
                dayElement.appendChild(dayNumber);
                
                // Add events for this date
                const dayEvents = getEventsForDate(date);
                dayEvents.forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = `event-item event-${event.type}`;
                    eventElement.textContent = event.title;
                    eventElement.onclick = () => editEvent(event.id);
                    dayElement.appendChild(eventElement);
                });
                
                // Add click handler to add new event
                dayElement.onclick = (e) => {
                    if (e.target === dayElement || e.target === dayNumber) {
                        showAddEventModal(date);
                    }
                };
                
                calendarGrid.appendChild(dayElement);
            }
            
            // Update mini calendar
            renderMiniCalendar();
            
            // Update upcoming events
            renderUpcomingEvents();
        }

        function renderMiniCalendar() {
            const miniCalendar = document.getElementById('mini-calendar');
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            
            let html = `
                <div class="text-center font-semibold mb-2">${monthNames[month]} ${year}</div>
                <div class="grid grid-cols-7 gap-1 text-xs">
                    <div class="text-center font-medium">S</div>
                    <div class="text-center font-medium">M</div>
                    <div class="text-center font-medium">T</div>
                    <div class="text-center font-medium">W</div>
                    <div class="text-center font-medium">T</div>
                    <div class="text-center font-medium">F</div>
                    <div class="text-center font-medium">S</div>
            `;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const today = new Date();
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                let classes = 'calendar-mini-day';
                if (date.toDateString() === today.toDateString()) {
                    classes += ' today';
                } else if (getEventsForDate(date).length > 0) {
                    classes += ' has-event';
                }
                
                html += `<div class="${classes}" onclick="goToDate('${date.toISOString()}')">${date.getDate()}</div>`;
            }
            
            html += '</div>';
            miniCalendar.innerHTML = html;
        }

        function renderUpcomingEvents() {
            const upcomingEvents = document.getElementById('upcoming-events');
            const today = new Date();
            const nextWeek = new Date(today);
            nextWeek.setDate(today.getDate() + 7);
            
            const upcoming = events
                .filter(event => {
                    const eventDate = new Date(event.startDate);
                    return eventDate >= today && eventDate <= nextWeek;
                })
                .sort((a, b) => new Date(a.startDate) - new Date(b.startDate))
                .slice(0, 5);
            
            if (upcoming.length === 0) {
                upcomingEvents.innerHTML = '<p class="text-gray-500 text-center py-4">No upcoming events this week</p>';
                return;
            }
            
            upcomingEvents.innerHTML = upcoming.map(event => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer" onclick="editEvent(${event.id})">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 rounded-full event-${event.type}"></div>
                        <div>
                            <div class="font-medium text-gray-900">${event.title}</div>
                            <div class="text-sm text-gray-500">${formatDate(event.startDate)} ${event.startTime ? 'â€¢ ' + formatTime(event.startTime) : ''}</div>
                        </div>
                    </div>
                    <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400"></i>
                </div>
            `).join('');
            
            // Re-initialize Lucide icons for new content
            lucide.createIcons();
        }

        function getEventsForDate(date) {
            const dateString = date.toISOString().split('T')[0];
            return events.filter(event => {
                const eventStart = event.startDate;
                const eventEnd = event.endDate || event.startDate;
                return dateString >= eventStart && dateString <= eventEnd;
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                weekday: 'short', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        function formatTime(timeString) {
            if (!timeString) return '';
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        // Navigation functions
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function goToToday() {
            currentDate = new Date();
            renderCalendar();
        }

        function goToDate(dateString) {
            currentDate = new Date(dateString);
            renderCalendar();
        }

        function switchView(view) {
            // Update active button
            document.querySelectorAll('.view-toggle button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Here you could implement different view logic
            if (view === 'year') {
                alert('Year view coming soon!');
            }
        }

        // Modal functions
        function showAddEventModal(selectedDate = null) {
            editingEventId = null;
            document.getElementById('modal-title').textContent = 'Add New Event';
            document.getElementById('event-form').reset();
            
            if (selectedDate) {
                const dateString = selectedDate.toISOString().split('T')[0];
                document.getElementById('event-start-date').value = dateString;
                document.getElementById('event-end-date').value = dateString;
            }
            
            document.getElementById('event-modal').classList.remove('hidden');
        }

        function closeEventModal() {
            document.getElementById('event-modal').classList.add('hidden');
            editingEventId = null;
        }

        function editEvent(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            editingEventId = eventId;
            document.getElementById('modal-title').textContent = 'Edit Event';
            
            // Populate form
            document.getElementById('event-title').value = event.title;
            document.getElementById('event-description').value = event.description || '';
            document.getElementById('event-start-date').value = event.startDate;
            document.getElementById('event-end-date').value = event.endDate || event.startDate;
            document.getElementById('event-type').value = event.type;
            document.getElementById('event-start-time').value = event.startTime || '';
            document.getElementById('event-end-time').value = event.endTime || '';
            
            document.getElementById('event-modal').classList.remove('hidden');
        }

        function saveEvent(e) {
            e.preventDefault();
            
            const formData = {
                title: document.getElementById('event-title').value,
                description: document.getElementById('event-description').value,
                startDate: document.getElementById('event-start-date').value,
                endDate: document.getElementById('event-end-date').value || document.getElementById('event-start-date').value,
                type: document.getElementById('event-type').value,
                startTime: document.getElementById('event-start-time').value,
                endTime: document.getElementById('event-end-time').value
            };
            
            if (editingEventId) {
                // Update existing event
                const eventIndex = events.findIndex(e => e.id === editingEventId);
                if (eventIndex !== -1) {
                    events[eventIndex] = { ...events[eventIndex], ...formData };
                }
            } else {
                // Add new event
                const newEvent = {
                    id: events.length + 1,
                    ...formData
                };
                events.push(newEvent);
            }
            
            closeEventModal();
            renderCalendar();
        }

        function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event?')) {
                events = events.filter(e => e.id !== eventId);
                renderCalendar();
            }
        }

        function exportCalendar() {
            // Create CSV content
            const csvContent = [
                ['Title', 'Description', 'Start Date', 'End Date', 'Type', 'Start Time', 'End Time'],
                ...events.map(event => [
                    event.title,
                    event.description || '',
                    event.startDate,
                    event.endDate || event.startDate,
                    event.type,
                    event.startTime || '',
                    event.endTime || ''
                ])
            ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `academic-calendar-${currentDate.getFullYear()}-${currentDate.getMonth() + 1}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeEventModal();
            }
            if (e.key === 'n' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                showAddEventModal();
            }
            if (e.key === 'ArrowLeft' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                previousMonth();
            }
            if (e.key === 'ArrowRight' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                nextMonth();
            }
            if (e.key === 't' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                goToToday();
            }
        });

        // Initialize calendar on page load
        document.addEventListener('DOMContentLoaded', function() {
            renderCalendar();
        });

        // Add context menu for events (right-click)
        document.addEventListener('contextmenu', function(e) {
            if (e.target.classList.contains('event-item')) {
                e.preventDefault();
                
                // Create context menu
                const contextMenu = document.createElement('div');
                contextMenu.className = 'fixed bg-white border border-gray-200 rounded-lg shadow-lg py-2 z-50';
                contextMenu.style.left = e.pageX + 'px';
                contextMenu.style.top = e.pageY + 'px';
                
                contextMenu.innerHTML = `
                    <button onclick="editEvent(${e.target.onclick.toString().match(/\d+/)[0]})" class="w-full text-left px-4 py-2 hover:bg-gray-50 text-sm">
                        <i data-lucide="edit" class="w-4 h-4 inline mr-2"></i>
                        Edit Event
                    </button>
                    <button onclick="deleteEvent(${e.target.onclick.toString().match(/\d+/)[0]})" class="w-full text-left px-4 py-2 hover:bg-gray-50 text-sm text-red-600">
                        <i data-lucide="trash-2" class="w-4 h-4 inline mr-2"></i>
                        Delete Event
                    </button>
                `;
                
                document.body.appendChild(contextMenu);
                lucide.createIcons();
                
                // Remove menu when clicking elsewhere
                setTimeout(() => {
                    document.addEventListener('click', function removeMenu() {
                        if (contextMenu.parentNode) {
                            contextMenu.remove();
                        }
                        document.removeEventListener('click', removeMenu);
                    });
                }, 10);
            }
        });

        // Add drag and drop functionality for events
        let draggedEvent = null;

        document.addEventListener('dragstart', function(e) {
            if (e.target.classList.contains('event-item')) {
                draggedEvent = e.target;
                e.dataTransfer.effectAllowed = 'move';
            }
        });

        document.addEventListener('dragover', function(e) {
            if (e.target.classList.contains('calendar-day')) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                e.target.style.backgroundColor = '#e0f2fe';
            }
        });

        document.addEventListener('dragleave', function(e) {
            if (e.target.classList.contains('calendar-day')) {
                e.target.style.backgroundColor = '';
            }
        });

        document.addEventListener('drop', function(e) {
            if (e.target.classList.contains('calendar-day') && draggedEvent) {
                e.preventDefault();
                e.target.style.backgroundColor = '';
                
                // Calculate new date for the event
                const calendarDays = Array.from(document.querySelectorAll('.calendar-day'));
                const dayIndex = calendarDays.indexOf(e.target);
                
                if (dayIndex !== -1) {
                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth();
                    const firstDay = new Date(year, month, 1);
                    const startDate = new Date(firstDay);
                    startDate.setDate(startDate.getDate() - firstDay.getDay() + dayIndex);
                    
                    const newDateString = startDate.toISOString().split('T')[0];
                    
                    // Find and update the event
                    const eventId = parseInt(draggedEvent.onclick.toString().match(/\d+/)[0]);
                    const event = events.find(e => e.id === eventId);
                    if (event) {
                        event.startDate = newDateString;
                        if (!event.endDate || event.endDate === event.startDate) {
                            event.endDate = newDateString;
                        }
                        renderCalendar();
                    }
                }
                
                draggedEvent = null;
            }
        });

        // Make event items draggable
        document.addEventListener('DOMContentLoaded', function() {
            const style = document.createElement('style');
            style.textContent = '.event-item { draggable: true; cursor: move; }';
            document.head.appendChild(style);
        });
    </script>
</body>
</html>