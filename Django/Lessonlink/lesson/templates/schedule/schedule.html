<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LessonLink - Class Schedule</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<script>
tailwind.config = {
    theme: {
        extend: {
            animation: {
                'fade-in': 'fadeIn 0.3s ease-in-out',
                'slide-in': 'slideIn 0.3s ease-out',
                'scale-in': 'scaleIn 0.2s ease-out',
                'bounce-in': 'bounceIn 0.4s ease-out',
                'slide-up': 'slideUp 0.3s ease-out'
            }
        }
    }
}
</script>
<style>
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideIn {
    from {
        transform: translateX(-100%);
    }

    to {
        transform: translateX(0);
    }
}

@keyframes scaleIn {
    from {
        opacity: 0;
        transform: scale(0.9) translateY(-10px);
    }

    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

@keyframes bounceIn {
    0% {
        opacity: 0;
        transform: scale(0.3) translateY(-50px);
    }
    50% {
        opacity: 1;
        transform: scale(1.05);
    }
    70% {
        transform: scale(0.98);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.sidebar-transition {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.dropdown-enter {
    animation: scaleIn 0.2s ease-out;
}

.schedule-grid {
    display: grid;
    grid-template-columns: 80px repeat(5, 1fr);
    gap: 1px;
}

@media (min-width: 768px) {
    .schedule-grid {
        grid-template-columns: 120px repeat(5, 1fr);
    }
}

.time-slot {
    min-height: 60px;
    border: 1px solid #e5e7eb;
}

.schedule-item {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 6px;
    padding: 8px;
    margin: 2px;
    font-size: 12px;
    cursor: pointer;
    transition: box-shadow 0.2s ease;
    overflow: hidden;
    text-overflow: ellipsis;
}

.schedule-item:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

/* Mobile schedule view */
.mobile-day-view {
    display: none;
}

@media (max-width: 767px) {
    .mobile-day-view {
        display: block;
    }
    
    .desktop-schedule {
        display: none;
    }
    
    .mobile-day-header {
        position: sticky;
        top: 64px;
        background: white;
        z-index: 10;
        padding: 12px 16px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .mobile-day-selector {
        display: flex;
        overflow-x: auto;
        padding-bottom: 8px;
        -webkit-overflow-scrolling: touch;
    }
    
    .mobile-day-tab {
        flex: 0 0 auto;
        padding: 8px 16px;
        margin-right: 8px;
        border-radius: 20px;
        background: #f3f4f6;
        color: #6b7280;
        font-weight: 500;
        white-space: nowrap;
    }
    
    .mobile-day-tab.active {
        background: #11468F;
        color: white;
    }
    
    .mobile-time-slot {
        padding: 12px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .mobile-time-label {
        font-weight: 500;
        color: #11468F;
        margin-bottom: 8px;
    }
}

/* Improved modal for mobile */
@media (max-width: 640px) {
    #add-class-modal > div {
        width: 100%;
        max-height: 100vh;
        border-radius: 0;
    }
}

/* Custom Pop-up Styles */
.popup-modal {
    backdrop-filter: blur(4px);
    animation: fadeIn 0.3s ease-out;
}

.popup-content {
    animation: bounceIn 0.4s ease-out;
}

.notification-toast {
    animation: slideUp 0.3s ease-out;
}
</style>
</head>

<body class="bg-gray-50">
<!-- Header -->
<header class="bg-white shadow-sm border-b fixed top-0 left-0 right-0 z-50">
<div class="flex items-center justify-between px-4 py-3 md:px-6 md:py-4">
    <!-- Mobile menu button -->
    <button id="mobile-menu-btn"
        class="md:hidden p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors">
        <i class="fas fa-bars text-lg"></i>
    </button>

    <!-- Logo -->
    <div class="flex items-center space-x-3 flex-1 md:flex-none">
        <div class="w-10 h-10 bg-gradient-to-r from-[#11468F] to-[#9E5EFF] rounded-full shadow-md"></div>
        <div class="hidden sm:block">
            <h1 class="text-xl font-bold text-gray-900">LessonLink</h1>
            <p class="text-sm text-gray-500 hidden lg:block">Western Mindanao State University</p>
        </div>
    </div>

    <!-- Right side actions -->
    <div class="flex items-center space-x-2 md:space-x-4">
        <!-- Search -->
        <div class="relative hidden md:block">
            <input type="text" placeholder="Search lessons..."
                class="w-64 px-4 py-2 bg-gray-50 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
            <i class="fas fa-search absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        </div>

        <!-- Mobile search button -->
        <button class="md:hidden p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
            <i class="fas fa-search text-lg"></i>
        </button>

        <!-- Notifications -->
        <div class="relative">
            <button id="notification-btn"
                class="relative p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                <i class="fas fa-bell text-lg"></i>
                <span id="notification-badge"
                    class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
            </button>

            <!-- Notifications Dropdown -->
            <div id="notification-dropdown" class="absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg border border-gray-200 hidden z-50">
                <div class="p-4 border-b border-gray-100">
                    <div class="flex items-center justify-between">
                        <h3 class="font-semibold text-gray-900">Notifications</h3>
                        <button class="text-purple-600 text-sm hover:text-purple-700" onclick="markAllNotificationsAsRead()">
                            Mark all read
                        </button>
                    </div>
                </div>
                <div class="max-h-96 overflow-y-auto">
                    <!-- Notifications will be loaded here dynamically -->
                </div>
                <div class="p-4 border-t border-gray-100">
                    <button class="w-full text-center text-purple-600 text-sm hover:text-purple-700 font-medium">
                        View all notifications
                    </button>
                </div>
            </div>
        </div>

        
        <!-- Profile -->
        <div class="relative">
            <button id="profile-btn"
                class="w-10 h-10 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center hover:bg-gray-300 transition-colors">
                <i class="fas fa-user text-gray-500"></i>
            </button>

            <!-- Profile Dropdown -->
            <div id="profile-dropdown"
                class="absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-lg border border-gray-200 hidden z-50">
                <div class="p-4 border-b border-gray-100">
                    <div class="flex items-center space-x-3">
                        <div
                            class="w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center">
                            <i class="fas fa-user text-white text-lg"></i>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-900">John Doe</p>
                            <p class="text-sm text-gray-500">Teacher</p>
                        </div>
                    </div>
                </div>
                <div class="py-2">
                    <a href="#"
                        class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-50 transition-colors">
                        <i class="fas fa-user w-4"></i>
                        <span>My Profile</span>
                    </a>
                    <a href="#"
                        class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-50 transition-colors">
                        <i class="fas fa-cog w-4"></i>
                        <span>Settings</span>
                    </a>
                    <hr class="my-2">
                    <a href="#"
                        class="flex items-center space-x-3 px-4 py-3 text-red-600 hover:bg-red-50 transition-colors">
                        <i class="fas fa-sign-out-alt w-4"></i>
                        <span>Sign Out</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
</header>

<div class="flex pt-16">
<!-- Sidebar -->
<aside id="sidebar"
            class="w-64 bg-white shadow-lg h-screen fixed top-20 left-0 -translate-x-full md:translate-x-0 sidebar-transition z-30 overflow-y-auto">
            <nav class="p-4 space-y-2">
                <!-- Create Lesson Button -->
                <button
                    class="w-full flex items-center space-x-3 px-4 py-3 bg-gradient-to-r from-[#11468F] to-[#9E5EFF] text-white rounded-lg hover:from-[#0d3a7a] hover:to-[#8c4de6] transition-all shadow-md">
                    <i class="fas fa-plus text-lg"></i>
                    <span class="font-medium">Create Lesson</span>
                </button>

                <!-- Navigation Items -->
                <a href="{% url 'dashboard' %}"
                    class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-[#f0f5ff] rounded-lg transition-colors group">
                    <i class="fas fa-home text-lg w-5 group-hover:text-[#11468F] transition-colors"></i>
                    <span>Dashboard</span>
                </a>
                <a href="{% url 'draft_list' %}"
                    class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-[#f0f5ff] rounded-lg transition-colors group">
                    <i class="fas fa-file-alt text-lg w-5 group-hover:text-[#11468F] transition-colors"></i>
                    <span>Drafts</span>
                </a>
                <a href="{% url 'task' %}"
                    class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-[#f0f5ff] rounded-lg transition-colors group">
                    <i class="fas fa-tasks text-lg w-5 group-hover:text-[#11468F] transition-colors"></i>
                    <span>Tasks</span>
                </a>
                <a href="{% url 'schedule' %}"
                    class="flex items-center space-x-3 px-4 py-3 text-[#11468F] bg-[#f0f5ff] rounded-lg border border-[#d6e0ff]">
                    <i class="fas fa-clock text-lg w-5"></i>
                    <span class="font-medium">Schedule</span>
                </a>
                <a href="{% url 'calendar' %}"
                    class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-[#f0f5ff] rounded-lg transition-colors group">
                    <i class="fas fa-calendar text-lg w-5 group-hover:text-[#11468F] transition-colors"></i>
                    <span>Calendar</span>
                </a>
            </nav>
        </aside>

<!-- Overlay for mobile -->
<div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div>

<!-- Main Content -->
<main class="flex-1 md:ml-64 p-4 md:p-6 min-h-screen">
    <!-- Header Section -->
    <div class="mb-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
            <div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Class Schedule</h2>
                <p class="text-gray-600">Manage your weekly class schedule</p>
            </div>
            <button id="add-class-btn"
                class="mt-4 md:mt-0 bg-[#11468F] text-white px-6 py-3 rounded-lg hover:bg-[#0d3a7a] transition-all shadow-md flex items-center space-x-2">
                <i class="fas fa-plus"></i>
                <span>Add Class</span>
            </button>
        </div>
    </div>

    <!-- Desktop Schedule Grid (hidden on mobile) -->
    <div class="desktop-schedule bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
        <div class="schedule-grid">
            <!-- Header -->
            <div class="bg-gray-50 p-3 text-center font-medium text-gray-700 rounded-tl-lg">Time</div>
            <div class="bg-gray-50 p-3 text-center font-medium text-gray-700">Monday</div>
            <div class="bg-gray-50 p-3 text-center font-medium text-gray-700">Tuesday</div>
            <div class="bg-gray-50 p-3 text-center font-medium text-gray-700">Wednesday</div>
            <div class="bg-gray-50 p-3 text-center font-medium text-gray-700">Thursday</div>
            <div class="bg-gray-50 p-3 text-center font-medium text-gray-700 rounded-tr-lg">Friday</div>

            <!-- Time Slots -->
            <div class="time-slot bg-gray-50 p-3 text-sm text-[#11468F] font-medium flex items-center">8:00 - 9:00 AM</div>
            <div class="time-slot bg-white relative" data-day="monday" data-time="8:00 - 9:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="tuesday" data-time="8:00 - 9:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="wednesday" data-time="8:00 - 9:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="thursday" data-time="8:00 - 9:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="friday" data-time="8:00 - 9:00 AM"></div>

            <div class="time-slot bg-gray-50 p-3 text-sm text-[#11468F] font-medium flex items-center">9:00 - 10:00 AM</div>
            <div class="time-slot bg-white relative" data-day="monday" data-time="9:00 - 10:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="tuesday" data-time="9:00 - 10:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="wednesday" data-time="9:00 - 10:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="thursday" data-time="9:00 - 10:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="friday" data-time="9:00 - 10:00 AM"></div>

            <div class="time-slot bg-gray-50 p-3 text-sm text-[#11468F] font-medium flex items-center">10:00 - 11:00 AM</div>
            <div class="time-slot bg-white relative" data-day="monday" data-time="10:00 - 11:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="tuesday" data-time="10:00 - 11:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="wednesday" data-time="10:00 - 11:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="thursday" data-time="10:00 - 11:00 AM"></div>
            <div class="time-slot bg-white relative" data-day="friday" data-time="10:00 - 11:00 AM"></div>

            <div class="time-slot bg-gray-50 p-3 text-sm text-[#11468F] font-medium flex items-center">11:00 - 12:00 PM</div>
            <div class="time-slot bg-white relative" data-day="monday" data-time="11:00 - 12:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="tuesday" data-time="11:00 - 12:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="wednesday" data-time="11:00 - 12:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="thursday" data-time="11:00 - 12:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="friday" data-time="11:00 - 12:00 PM"></div>

            <div class="time-slot bg-gray-50 p-3 text-sm text-[#11468F] font-medium flex items-center">12:00 - 1:00 PM</div>
            <div class="time-slot bg-red-50 relative flex items-center justify-center text-red-600 text-sm font-medium" colspan="5">
                <span>Lunch Break</span>
            </div>
            <div class="time-slot bg-red-50 relative flex items-center justify-center text-red-600 text-sm font-medium"></div>
            <div class="time-slot bg-red-50 relative flex items-center justify-center text-red-600 text-sm font-medium"></div>
            <div class="time-slot bg-red-50 relative flex items-center justify-center text-red-600 text-sm font-medium"></div>
            <div class="time-slot bg-red-50 relative flex items-center justify-center text-red-600 text-sm font-medium"></div>

            <div class="time-slot bg-gray-50 p-3 text-sm text-[#11468F] font-medium flex items-center">1:00 - 2:00 PM</div>
            <div class="time-slot bg-white relative" data-day="monday" data-time="1:00 - 2:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="tuesday" data-time="1:00 - 2:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="wednesday" data-time="1:00 - 2:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="thursday" data-time="1:00 - 2:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="friday" data-time="1:00 - 2:00 PM"></div>

            <div class="time-slot bg-gray-50 p-3 text-sm text-[#11468F] font-medium flex items-center">2:00 - 3:00 PM</div>
            <div class="time-slot bg-white relative" data-day="monday" data-time="2:00 - 3:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="tuesday" data-time="2:00 - 3:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="wednesday" data-time="2:00 - 3:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="thursday" data-time="2:00 - 3:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="friday" data-time="2:00 - 3:00 PM"></div>

            <div class="time-slot bg-gray-50 p-3 text-sm text-[#11468F] font-medium flex items-center">3:00 - 4:00 PM</div>
            <div class="time-slot bg-white relative" data-day="monday" data-time="3:00 - 4:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="tuesday" data-time="3:00 - 4:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="wednesday" data-time="3:00 - 4:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="thursday" data-time="3:00 - 4:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="friday" data-time="3:00 - 4:00 PM"></div>

            <div class="time-slot bg-gray-50 p-3 text-sm text-[#11468F] font-medium flex items-center">4:00 - 5:00 PM</div>
            <div class="time-slot bg-white relative" data-day="monday" data-time="4:00 - 5:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="tuesday" data-time="4:00 - 5:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="wednesday" data-time="4:00 - 5:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="thursday" data-time="4:00 - 5:00 PM"></div>
            <div class="time-slot bg-white relative" data-day="friday" data-time="4:00 - 5:00 PM"></div>
        </div>
    </div>

    <!-- Mobile Schedule View (hidden on desktop) -->
    <div class="mobile-day-view bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="mobile-day-header">
            <div class="mobile-day-selector">
                <button class="mobile-day-tab active" data-day="monday">Monday</button>
                <button class="mobile-day-tab" data-day="tuesday">Tuesday</button>
                <button class="mobile-day-tab" data-day="wednesday">Wednesday</button>
                <button class="mobile-day-tab" data-day="thursday">Thursday</button>
                <button class="mobile-day-tab" data-day="friday">Friday</button>
            </div>
        </div>
        
        <div class="mobile-day-content">
            <!-- Time slots will be populated by JavaScript -->
        </div>
    </div>
</main>
</div>

<!-- Add Class Modal -->
<div id="add-class-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
<div class="bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
    <div class="p-6">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-gray-900">Add New Class</h3>
            <button id="close-modal" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-lg"></i>
            </button>
        </div>

        <form id="add-class-form" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                <input type="text" id="subject-input" required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                    placeholder="e.g. Mathematics, English, Science">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                <textarea id="description-input" rows="3"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                    placeholder="Brief description of the class..."></textarea>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Day</label>
                <select id="day-selector" required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <option value="">Select Day</option>
                    <option value="monday">Monday</option>
                    <option value="tuesday">Tuesday</option>
                    <option value="wednesday">Wednesday</option>
                    <option value="thursday">Thursday</option>
                    <option value="friday">Friday</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                <select id="time-selector" required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <option value="">Select Time</option>
                    <option value="8:00 - 9:00 AM">8:00 - 9:00 AM</option>
                    <option value="9:00 - 10:00 AM">9:00 - 10:00 AM</option>
                    <option value="10:00 - 11:00 AM">10:00 - 11:00 AM</option>
                    <option value="11:00 - 12:00 PM">11:00 - 12:00 PM</option>
                    <option value="1:00 - 2:00 PM">1:00 - 2:00 PM</option>
                    <option value="2:00 - 3:00 PM">2:00 - 3:00 PM</option>
                    <option value="3:00 - 4:00 PM">3:00 - 4:00 PM</option>
                    <option value="4:00 - 5:00 PM">4:00 - 5:00 PM</option>
                </select>
            </div>

            <div class="flex space-x-3 pt-4">
                <button type="button" id="cancel-btn"
                    class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                    Cancel
                </button>
                <button type="submit"
                    class="flex-1 px-6 py-3 bg-[#11468F] text-white rounded-lg hover:bg-[#0d3a7a] transition-all">
                    Add Class
                </button>
            </div>
        </form>
    </div>
</div>
</div>

<!-- Custom Confirmation Modal -->
<div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[9999] hidden flex items-center justify-center p-4 popup-modal">
    <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full popup-content">
        <div class="p-6 text-center">
            <div class="w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center">
                <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">Remove Class</h3>
            <p class="text-gray-600 mb-6">Are you sure you want to remove this class from your schedule?</p>
            
            <div class="flex space-x-3">
                <button id="confirm-cancel" 
                    class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                    Cancel
                </button>
                <button id="confirm-delete" 
                    class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium">
                    Remove
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div id="error-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[9999] hidden flex items-center justify-center p-4 popup-modal">
    <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full popup-content">
        <div class="p-6 text-center">
            <div class="w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center">
                <i class="fas fa-times-circle text-red-600 text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">Error</h3>
            <p id="error-message" class="text-gray-600 mb-6">Something went wrong. Please try again.</p>
            
            <button id="error-ok" 
                class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium">
                OK
            </button>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div id="success-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[9999] hidden flex items-center justify-center p-4 popup-modal">
    <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full popup-content">
        <div class="p-6 text-center">
            <div class="w-16 h-16 mx-auto mb-4 bg-green-100 rounded-full flex items-center justify-center">
                <i class="fas fa-check-circle text-green-600 text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">Success!</h3>
            <p id="success-message" class="text-gray-600 mb-6">Class has been added successfully.</p>
            
            <button id="success-ok" 
                class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
                OK
            </button>
        </div>
    </div>
</div>

<!-- Validation Modal -->
<div id="validation-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[9999] hidden flex items-center justify-center p-4 popup-modal">
    <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full popup-content">
        <div class="p-6 text-center">
            <div class="w-16 h-16 mx-auto mb-4 bg-yellow-100 rounded-full flex items-center justify-center">
                <i class="fas fa-exclamation-circle text-yellow-600 text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">Validation Error</h3>
            <p id="validation-message" class="text-gray-600 mb-6">Please fill in all required fields.</p>
            
            <button id="validation-ok" 
                class="w-full px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors font-medium">
                OK
            </button>
        </div>
    </div>
</div>

<!-- Toast Notifications Container -->
<div id="toast-container" class="fixed top-20 right-4 z-[9998] space-y-2"></div>

<script>
// Store schedule data
let scheduleData = {};

// Modal and notification functions
function showConfirmation(message, onConfirm) {
    const modal = document.getElementById('confirmation-modal');
    const confirmBtn = document.getElementById('confirm-delete');
    const cancelBtn = document.getElementById('confirm-cancel');
    
    // Update message if provided
    if (message) {
        modal.querySelector('p').textContent = message;
    }
    
    modal.classList.remove('hidden');
    
    // Remove existing event listeners
    const newConfirmBtn = confirmBtn.cloneNode(true);
    const newCancelBtn = cancelBtn.cloneNode(true);
    confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
    cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);
    
    // Add new event listeners
    newConfirmBtn.addEventListener('click', () => {
        modal.classList.add('hidden');
        onConfirm();
    });
    
    newCancelBtn.addEventListener('click', () => {
        modal.classList.add('hidden');
    });
}

function showError(message) {
    const modal = document.getElementById('error-modal');
    const errorMessage = document.getElementById('error-message');
    const okBtn = document.getElementById('error-ok');
    
    errorMessage.textContent = message;
    modal.classList.remove('hidden');
    
    okBtn.onclick = () => {
        modal.classList.add('hidden');
    };
}

function showSuccess(message) {
    const modal = document.getElementById('success-modal');
    const successMessage = document.getElementById('success-message');
    const okBtn = document.getElementById('success-ok');
    
    successMessage.textContent = message;
    modal.classList.remove('hidden');
    
    okBtn.onclick = () => {
        modal.classList.add('hidden');
    };
}

function showValidation(message) {
    const modal = document.getElementById('validation-modal');
    const validationMessage = document.getElementById('validation-message');
    const okBtn = document.getElementById('validation-ok');
    
    validationMessage.textContent = message;
    modal.classList.remove('hidden');
    
    okBtn.onclick = () => {
        modal.classList.add('hidden');
    };
}

function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    
    const icons = {
        success: 'fas fa-check-circle text-green-600',
        error: 'fas fa-times-circle text-red-600',
        warning: 'fas fa-exclamation-triangle text-yellow-600',
        info: 'fas fa-info-circle text-blue-600'
    };
    
    const colors = {
        success: 'bg-green-50 border-green-200',
        error: 'bg-red-50 border-red-200',
        warning: 'bg-yellow-50 border-yellow-200',
        info: 'bg-blue-50 border-blue-200'
    };
    
    toast.className = `notification-toast flex items-center p-4 mb-2 ${colors[type]} border rounded-lg shadow-lg max-w-sm`;
    toast.innerHTML = `
        <i class="${icons[type]} mr-3"></i>
        <span class="text-sm font-medium text-gray-800">${message}</span>
        <button class="ml-auto text-gray-400 hover:text-gray-600" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    container.appendChild(toast);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (toast.parentElement) {
            toast.style.opacity = '0';
            toast.style.transform = 'translateY(-10px)';
            setTimeout(() => toast.remove(), 300);
        }
    }, 5000);
}

// DOM elements
const mobileMenuBtn = document.getElementById('mobile-menu-btn');
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');
const notificationBtn = document.getElementById('notification-btn');
const notificationDropdown = document.getElementById('notification-dropdown');
const profileBtn = document.getElementById('profile-btn');
const profileDropdown = document.getElementById('profile-dropdown');
const addClassBtn = document.getElementById('add-class-btn');
const addClassModal = document.getElementById('add-class-modal');
const closeModal = document.getElementById('close-modal');
const cancelBtn = document.getElementById('cancel-btn');
const addClassForm = document.getElementById('add-class-form');
const mobileDayTabs = document.querySelectorAll('.mobile-day-tab');
const mobileDayContent = document.querySelector('.mobile-day-content');

// Mobile menu toggle
mobileMenuBtn.addEventListener('click', () => {
    sidebar.classList.toggle('-translate-x-full');
    overlay.classList.toggle('hidden');
});

overlay.addEventListener('click', () => {
    sidebar.classList.add('-translate-x-full');
    overlay.classList.add('hidden');
});

// Dropdown toggles
notificationBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    notificationDropdown.classList.toggle('hidden');
    profileDropdown.classList.add('hidden');
});

profileBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    profileDropdown.classList.toggle('hidden');
    notificationDropdown.classList.add('hidden');
});

// Close dropdowns when clicking outside
document.addEventListener('click', () => {
    notificationDropdown.classList.add('hidden');
    profileDropdown.classList.add('hidden');
});

// Modal controls
addClassBtn.addEventListener('click', () => {
    addClassModal.classList.remove('hidden');
});

closeModal.addEventListener('click', () => {
    addClassModal.classList.add('hidden');
    addClassForm.reset();
});

cancelBtn.addEventListener('click', () => {
    addClassModal.classList.add('hidden');
    addClassForm.reset();
});

// Close modal when clicking outside
addClassModal.addEventListener('click', (e) => {
    if (e.target === addClassModal) {
        addClassModal.classList.add('hidden');
        addClassForm.reset();
    }
});

// Mobile day tabs
mobileDayTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        mobileDayTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        updateMobileDayView(tab.dataset.day);
    });
});

// Update mobile day view
function updateMobileDayView(day) {
    const times = [
        '8:00 - 9:00 AM',
        '9:00 - 10:00 AM',
        '10:00 - 11:00 AM',
        '11:00 - 12:00 PM',
        '12:00 - 1:00 PM',
        '1:00 - 2:00 PM',
        '2:00 - 3:00 PM',
        '3:00 - 4:00 PM',
        '4:00 - 5:00 PM'
    ];
    
    let html = '';
    
    times.forEach(time => {
        if (time === '12:00 - 1:00 PM') {
            html += `
                <div class="mobile-time-slot bg-red-50">
                    <div class="mobile-time-label text-red-600">${time}</div>
                    <div class="text-red-600 text-sm font-medium">Lunch Break</div>
                </div>
            `;
            return;
        }
        
        const classKey = `${day}-${time}`;
        const classData = scheduleData[classKey];
        
        html += `
            <div class="mobile-time-slot" data-day="${day}" data-time="${time}">
                <div class="mobile-time-label">${time}</div>
        `;
        
        if (classData) {
            html += `
                <div class="schedule-item" data-id="${classData.id}">
                    <div class="font-medium">${classData.subject}</div>
                    <div class="text-xs mt-1 opacity-90">${classData.description || ''}</div>
                </div>
            `;
        } else {
            html += `
                <button class="text-sm text-gray-500 hover:text-[#11468F]">
                    <i class="fas fa-plus mr-1"></i> Add Class
                </button>
            `;
        }
        
        html += `</div>`;
    });
    
    mobileDayContent.innerHTML = html;
    
    // Add click handlers to empty slots
    document.querySelectorAll('.mobile-time-slot[data-day]').forEach(slot => {
        if (!slot.querySelector('.schedule-item')) {
            slot.addEventListener('click', (e) => {
                if (!slot.querySelector('.schedule-item') && !e.target.closest('button')) {
                    // Pre-fill the modal with the clicked slot's data
                    document.getElementById('day-selector').value = slot.dataset.day;
                    document.getElementById('time-selector').value = slot.dataset.time;
                    addClassModal.classList.remove('hidden');
                }
            });
        }
    });
    
    // Add click handlers to schedule items
    document.querySelectorAll('.mobile-time-slot .schedule-item').forEach(item => {
        item.addEventListener('click', (e) => {
            e.stopPropagation();
            const slot = item.closest('.mobile-time-slot');
            const classId = item.dataset.id;
            
            showConfirmation('Are you sure you want to remove this class from your schedule?', () => {
                // Send delete request to server
                fetch(`/api/schedules/${classId}/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                    }
                })
                .then(response => {
                    if (response.ok) {
                        const classKey = `${slot.dataset.day}-${slot.dataset.time}`;
                        delete scheduleData[classKey];
                        updateScheduleDisplay();
                        updateMobileDayView(slot.dataset.day);
                        showToast('Class removed successfully', 'error');
                    } else {
                        showError('Error deleting class. Please try again.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showError('Error deleting class. Please try again.');
                });
            });
        });
    });
}

// Function to get CSRF token
function getCSRFToken() {
    const name = 'csrftoken';
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Form submission
addClassForm.addEventListener('submit', (e) => {
    e.preventDefault();
    
    const subject = document.getElementById('subject-input').value.trim();
    const description = document.getElementById('description-input').value.trim();
    const day = document.getElementById('day-selector').value;
    const time = document.getElementById('time-selector').value;

    if (!subject || !day || !time) {
        showValidation('Please fill in all required fields (Subject, Day, and Time).');
        return;
    }

    // Check if slot is already occupied
    const classKey = `${day}-${time}`;
    if (scheduleData[classKey]) {
        showError('This time slot is already occupied. Please choose a different time.');
        return;
    }

    // Simulate API call with loading state
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Adding...';
    submitBtn.disabled = true;

    // Send data to server
    fetch('/api/schedules/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken(),
        },
        body: JSON.stringify({
            subject,
            description,
            day,
            time
        })
    })
    .then(response => response.json())
    .then(classData => {
        // Store the class data
        scheduleData[classKey] = classData;

        // Update the display
        updateScheduleDisplay();
        
        // Update mobile view if on that day
        const activeDay = document.querySelector('.mobile-day-tab.active').dataset.day;
        if (activeDay === day) {
            updateMobileDayView(day);
        }

        // Close modal and reset form
        addClassModal.classList.add('hidden');
        addClassForm.reset();
        
        // Reset button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        
        // Show success notification
        showSuccess(`${subject} class has been added to your ${day} schedule.`);
        showToast(`${subject} added successfully`, 'success');
        
    })
    .catch(error => {
        console.error('Error:', error);
        
        // Reset button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        
        showError('Error adding class. Please try again.');
    });
});

function updateScheduleDisplay() {
    // Clear all existing schedule items
    document.querySelectorAll('.schedule-item').forEach(item => item.remove());

    // Add classes
    Object.values(scheduleData).forEach(classData => {
        const slot = document.querySelector(`[data-day="${classData.day}"][data-time="${classData.time}"]`);
        if (slot) {
            const scheduleItem = document.createElement('div');
            scheduleItem.className = 'schedule-item';
            scheduleItem.dataset.id = classData.id;
            scheduleItem.innerHTML = `
                <div class="font-medium">${classData.subject}</div>
                <div class="text-xs mt-1 opacity-90">${classData.description || ''}</div>
            `;
            
            // Add click handler to edit/remove
            scheduleItem.addEventListener('click', (e) => {
                e.stopPropagation();
                
                showConfirmation(`Are you sure you want to remove "${classData.subject}" from your schedule?`, () => {
                    // Send delete request to server
                    fetch(`/api/schedules/${classData.id}/`, {
                        method: 'DELETE',
                        headers: {
                            'X-CSRFToken': getCSRFToken(),
                        }
                    })
                    .then(response => {
                        if (response.ok) {
                            const classKey = `${classData.day}-${classData.time}`;
                            delete scheduleData[classKey];
                            updateScheduleDisplay();
                            
                            // Update mobile view if on that day
                            const activeDay = document.querySelector('.mobile-day-tab.active')?.dataset.day;
                            if (activeDay === classData.day) {
                                updateMobileDayView(classData.day);
                            }
                            
                            showToast('Class removed successfully', 'error');
                        } else {
                            showError('Error deleting class. Please try again.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showError('Error deleting class. Please try again.');
                    });
                });
            });

            slot.appendChild(scheduleItem);
        }
    });
}

// Initialize with empty schedule and load from database
document.addEventListener('DOMContentLoaded', function() {
    // Load existing schedule data from server
    fetch('/api/schedules/')
        .then(response => response.json())
        .then(data => {
            data.forEach(classData => {
                const classKey = `${classData.day}-${classData.time}`;
                scheduleData[classKey] = classData;
            });
            updateScheduleDisplay();
            updateMobileDayView('monday');
        })
        .catch(error => {
            console.error('Error loading schedule:', error);
            showError('Error loading schedule data. Please refresh the page.');
        });
});

// Add click handlers to empty time slots
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.time-slot[data-day]').forEach(slot => {
        slot.addEventListener('click', () => {
            if (!slot.querySelector('.schedule-item')) {
                // Pre-fill the modal with the clicked slot's data
                document.getElementById('day-selector').value = slot.dataset.day;
                document.getElementById('time-selector').value = slot.dataset.time;
                addClassModal.classList.remove('hidden');
            }
        });
    });
});

// Close modals when clicking outside
document.addEventListener('click', (e) => {
    const modals = ['confirmation-modal', 'error-modal', 'success-modal', 'validation-modal'];
    modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (e.target === modal) {
            modal.classList.add('hidden');
        }
    });
});

// ESC key to close modals
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        const modals = ['confirmation-modal', 'error-modal', 'success-modal', 'validation-modal', 'add-class-modal'];
        modals.forEach(modalId => {
            document.getElementById(modalId).classList.add('hidden');
        });
        addClassForm.reset();
    }
});
    // Notification system
    function loadNotifications() {
        fetch('/notifications/notifications/')
            .then(response => response.json())
            .then(data => {
                updateNotificationBadge(data.unread_count);
                updateNotificationDropdown(data.notifications);
            })
            .catch(error => {
                console.error('Error loading notifications:', error);
            });
    }

    function updateNotificationBadge(unreadCount) {
        const badge = document.getElementById('notification-badge');
        if (badge) {
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }
    }

    function updateNotificationDropdown(notifications) {
        const dropdown = document.getElementById('notification-dropdown');
        if (!dropdown) return;

        const notificationsContainer = dropdown.querySelector('.max-h-96') || dropdown;
        
        if (notifications.length === 0) {
            notificationsContainer.innerHTML = `
                <div class="p-4 text-center text-gray-500">
                    <i class="fas fa-bell-slash text-2xl mb-2"></i>
                    <p>No notifications</p>
                </div>
            `;
            return;
        }

        let notificationsHTML = '';
        notifications.forEach(notification => {
            const icon = getNotificationIcon(notification.type);
            const timeAgo = getTimeAgo(notification.created_at);
            const readClass = notification.is_read ? '' : 'bg-blue-50 border-l-4 border-l-blue-500';
            
            notificationsHTML += `
                <div class="p-4 hover:bg-gray-50 border-b border-gray-100 cursor-pointer ${readClass} notification-item" 
                    data-notification-id="${notification.id}" 
                    data-type="${notification.type}"
                    data-lesson-plan-id="${notification.lesson_plan_id || ''}"
                    data-submission-id="${notification.submission_id || ''}">
                    <div class="flex items-start space-x-3">
                        <div class="w-2 h-2 ${getNotificationColor(notification.type)} rounded-full mt-2 flex-shrink-0"></div>
                        <div class="flex-1">
                            <p class="text-sm text-gray-900 font-medium">${notification.title}</p>
                            <p class="text-xs text-gray-500 mt-1">${notification.message}</p>
                            <p class="text-xs text-gray-400 mt-1">${timeAgo}</p>
                        </div>
                        ${!notification.is_read ? '<div class="w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"></div>' : ''}
                    </div>
                </div>
            `;
        });

        // Clear existing content and add new notifications
        const existingContent = notificationsContainer.querySelector('.border-b') ? notificationsContainer : notificationsContainer.querySelector('.max-h-96') || notificationsContainer;
        existingContent.innerHTML = notificationsHTML;

        // Add click handlers
        document.querySelectorAll('.notification-item').forEach(item => {
            item.addEventListener('click', function() {
                const notificationId = this.getAttribute('data-notification-id');
                const type = this.getAttribute('data-type');
                const lessonPlanId = this.getAttribute('data-lesson-plan-id');
                const submissionId = this.getAttribute('data-submission-id');
                
                // Mark as read
                markNotificationAsRead(notificationId);
                
                // Handle navigation based on notification type
                handleNotificationClick(type, lessonPlanId, submissionId);
            });
        });
    }

    function getNotificationIcon(type) {
        const icons = {
            'draft_approved': 'fa-check-circle',
            'draft_rejected': 'fa-times-circle',
            'task_due_soon': 'fa-clock',
            'upcoming_schedule': 'fa-calendar',
            'lesson_submitted': 'fa-file-upload',
            'general': 'fa-bell'
        };
        return icons[type] || 'fa-bell';
    }

    function getNotificationColor(type) {
        const colors = {
            'draft_approved': 'bg-green-500',
            'draft_rejected': 'bg-red-500',
            'task_due_soon': 'bg-yellow-500',
            'upcoming_schedule': 'bg-blue-500',
            'lesson_submitted': 'bg-purple-500',
            'general': 'bg-gray-500'
        };
        return colors[type] || 'bg-gray-500';
    }

    function getTimeAgo(createdAt) {
        // Simple time ago calculation - you can use a library like day.js for better formatting
        return createdAt;
    }

    function markNotificationAsRead(notificationId) {
        fetch(`/notifications/notifications/${notificationId}/read/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update UI
                const notificationItem = document.querySelector(`[data-notification-id="${notificationId}"]`);
                if (notificationItem) {
                    notificationItem.classList.remove('bg-blue-50', 'border-l-4', 'border-l-blue-500');
                    const unreadDot = notificationItem.querySelector('.bg-blue-500');
                    if (unreadDot) {
                        unreadDot.remove();
                    }
                }
                // Reload notification count
                loadNotifications();
            }
        })
        .catch(error => {
            console.error('Error marking notification as read:', error);
        });
    }

    function handleNotificationClick(type, lessonPlanId, submissionId) {
        // Close notification dropdown
        const dropdown = document.getElementById('notification-dropdown');
        if (dropdown) {
            dropdown.classList.add('hidden');
        }

        // Navigate based on notification type
        switch(type) {
            case 'draft_approved':
            case 'draft_rejected':
            case 'lesson_submitted':
                if (submissionId) {
                    window.location.href = `/lesson-plan-detail/${submissionId}/`;
                } else if (lessonPlanId) {
                    window.location.href = `/drafts/${lessonPlanId}/view/`;
                }
                break;
            case 'task_due_soon':
                window.location.href = '/task/';
                break;
            case 'upcoming_schedule':
                window.location.href = '/schedule/';
                break;
            default:
                // Do nothing for general notifications
                break;
        }
    }

    // CSRF token helper
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Load notifications when page loads
    document.addEventListener('DOMContentLoaded', function() {
        loadNotifications();
        
        // Reload notifications every 30 seconds
        setInterval(loadNotifications, 30000);
    });
</script>
</body>

</html>